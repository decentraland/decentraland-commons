<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ethereum/SignedMessage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ethereum/SignedMessage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { eth } from './eth'

/**
 * Work with signatures made with Ethereum wallets
 */
export class SignedMessage {
  constructor(message, signature) {
    if (!message || !signature) {
      throw new Error('You need to supply a message and a signature')
    }

    this.message = message
    this.signature = signature
  }

  /**
   * Decodes the message for the given signature
   * @return {string} address - Address which signed the message
   */
  getAddress() {
    const decodedMessage = this.decodeMessage()
    const { v, r, s } = this.decodeSignature()

    const pubkey = eth.utils.ecrecover(
      eth.utils.hashPersonalMessage(decodedMessage),
      v,
      r,
      s
    )

    return '0x' + eth.utils.pubToAddressHex(pubkey)
  }

  /**
   * Decodes the signed message so it's ready to be stringified
   * @return {Buffer} - Buffer containing the decoded message
   */
  decodeMessage() {
    return new Buffer(this.message.substr(2), 'hex')
  }

  /**
   * Decodes the signature of a message
   * @return {Buffer} - Buffer containing the decoded signature
   */
  decodeSignature() {
    return eth.utils.fromRpcSig(new Buffer(this.signature.substr(2), 'hex'))
  }

  /**
   * Extract values from a signed message.
   * This function expects a particular message structure which looks like this:
   * @example
   * Header title
   * propery1: value1
   * propery2: value2
   * ...etc
   * @param  {Array&lt;string>|string} property - Property name or names to find
   * @return {Array&lt;string>} - The found values or null for each of the supplied properties
   */
  extract(properties) {
    if (!Array.isArray(properties)) properties = [properties]

    const message = this.decodeMessage().toString()
    const result = []

    properties.map(property => {
      const regexp = new RegExp(`^${property}:\\s(.*)$`, 'gim')
      const match = regexp.exec(message)

      const value = match &amp;&amp; match[1]
      result.push(value)
    })

    return result
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Contract.html">Contract</a></li><li><a href="DecentralandVesting.html">DecentralandVesting</a></li><li><a href="Event.html">Event</a></li><li><a href="LANDRegistry.html">LANDRegistry</a></li><li><a href="MANAToken.html">MANAToken</a></li><li><a href="Marketplace.html">Marketplace</a></li><li><a href="ReturnMANA.html">ReturnMANA</a></li><li><a href="SignedMessage.html">SignedMessage</a></li><li><a href="SMTP_SMTP.html">SMTP</a></li><li><a href="TerraformReserve.html">TerraformReserve</a></li></ul><h3>Namespaces</h3><ul><li><a href="eth.html">eth</a></li><li><a href="ethUtils.html">ethUtils</a></li><li><a href="mailchimp.html">mailchimp</a></li><li><a href="mongo.html">mongo</a></li><li><a href="postgres.html">postgres</a></li><li><a href="tunnel.html">tunnel</a></li><li><a href="txUtils.html">txUtils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#arrayToObject">arrayToObject</a></li><li><a href="global.html#confirm">confirm</a></li><li><a href="global.html#extractFromReq">extractFromReq</a></li><li><a href="global.html#handleRequest">handleRequest</a></li><li><a href="global.html#isEmptyObject">isEmptyObject</a></li><li><a href="global.html#mapOmit">mapOmit</a></li><li><a href="global.html#omit">omit</a></li><li><a href="global.html#pick">pick</a></li><li><a href="global.html#promisify">promisify</a></li><li><a href="global.html#prompt">prompt</a></li><li><a href="global.html#runProgram">runProgram</a></li><li><a href="global.html#sleep">sleep</a></li><li><a href="global.html#useRollbar">useRollbar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 06 2018 15:38:08 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
